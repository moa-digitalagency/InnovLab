{% extends "admin/layout.html" %}

{% block content %}
<div class="mb-8 flex items-center justify-between">
    <div>
        <h2 class="text-3xl font-bold text-white">SEO Avancé</h2>
        <p class="text-blue-100/80 mt-1">Configuration globale et optimisation par page.</p>
    </div>
</div>

<form method="POST" enctype="multipart/form-data" class="pb-12 space-y-8">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

    <!-- GLOBAL SEO CONFIGURATION -->
    <div class="bg-gray-800 rounded-xl p-8 border border-gray-700 shadow-lg relative overflow-hidden">
        <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
            <span class="material-symbols-outlined text-9xl">public</span>
        </div>
        <h3 class="text-xl font-bold text-teal-400 mb-6 flex items-center gap-2 relative z-10">
            <span class="material-symbols-outlined">settings_suggest</span>
            Configuration Globale
        </h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 relative z-10">
            <!-- Analytics & Robots -->
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Google Analytics ID</label>
                    <input type="text" name="google_analytics_id" value="{{ seo_map['index'].google_analytics_id if 'index' in seo_map and seo_map['index'].google_analytics_id else '' }}"
                           class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors placeholder-gray-600" placeholder="Ex: G-XXXXXXXXXX">
                    <p class="text-xs text-blue-100/60 mt-1">L'ID de mesure GA4.</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Fichier robots.txt</label>
                    <textarea name="robots_txt_content" rows="6"
                              class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2.5 text-white font-mono text-xs focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors placeholder-gray-600" placeholder="User-agent: *&#10;Disallow: /admin/">{{ seo_map['index'].robots_txt_content if 'index' in seo_map and seo_map['index'].robots_txt_content else '' }}</textarea>
                </div>

                <!-- Open Graph & Twitter -->
                <div>
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Nom du site (Open Graph)</label>
                    <input type="text" name="og_site_name" value="{{ seo_map['index'].og_site_name if 'index' in seo_map and seo_map['index'].og_site_name else '' }}"
                           class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors placeholder-gray-600">
                </div>

                <div>
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Twitter Handle</label>
                    <input type="text" name="twitter_handle" value="{{ seo_map['index'].twitter_handle if 'index' in seo_map and seo_map['index'].twitter_handle else '' }}"
                           class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors placeholder-gray-600" placeholder="@VotreCompte">
                </div>
            </div>

            <!-- Default Meta Tags -->
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Titre par défaut (Meta Title)</label>
                    <input type="text" name="meta_title_default" value="{{ seo_map['index'].meta_title_default if 'index' in seo_map and seo_map['index'].meta_title_default else '' }}"
                           class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors placeholder-gray-600">
                </div>

                <div>
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Description par défaut</label>
                    <textarea name="meta_description_default" rows="3"
                              class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors placeholder-gray-600">{{ seo_map['index'].meta_description_default if 'index' in seo_map and seo_map['index'].meta_description_default else '' }}</textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Mots-clés par défaut</label>
                    <input type="text" name="meta_keywords_default" value="{{ seo_map['index'].meta_keywords_default if 'index' in seo_map and seo_map['index'].meta_keywords_default else '' }}"
                           class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors placeholder-gray-600">
                </div>

                <!-- OG Image Upload -->
                <div>
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Image Open Graph par défaut</label>

                    <div class="flex items-center gap-4 mb-3">
                        {% if 'index' in seo_map and seo_map['index'].og_image_default %}
                        <div class="bg-gray-700 p-1 rounded-lg w-32 aspect-video flex items-center justify-center overflow-hidden border border-gray-600">
                            <img src="{{ url_for('static', filename=seo_map['index'].og_image_default) }}" class="w-full h-full object-cover" alt="OG Image Preview">
                        </div>
                        {% else %}
                        <div class="w-32 aspect-video bg-gray-700 rounded-lg flex items-center justify-center text-blue-100/60 text-xs border border-gray-600">
                            Aucune image
                        </div>
                        {% endif %}
                    </div>

                    <input type="file" name="og_image_default" accept="image/jpeg, image/png, image/webp"
                           class="block w-full text-sm text-blue-100/80 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-teal-600 file:text-white hover:file:bg-teal-500 cursor-pointer bg-gray-900 rounded-lg border border-gray-700">
                    <p class="text-xs text-amber-400/80 mt-2 flex items-center gap-1">
                        <span class="material-symbols-outlined text-sm">info</span>
                        L'URL de l'image OG doit pointer vers une image de 1200x630 pixels.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="border-t border-gray-700 my-8"></div>

    <!-- PER PAGE CONFIGURATION -->
    <h3 class="text-2xl font-bold text-white mb-6 pl-2 border-l-4 border-teal-500">Optimisation par Page</h3>

    <div class="grid grid-cols-1 gap-6">
        {% for page in pages %}
        <div class="bg-gray-800 rounded-xl p-6 border border-gray-700 shadow-md hover:border-teal-500/50 transition-colors">
            <h4 class="text-lg font-bold text-white mb-4 capitalize flex items-center gap-2">
                <span class="material-symbols-outlined text-teal-500">web_asset</span>
                {{ page }}
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Titre de la page</label>
                    <input type="text" name="title_{{ page }}" value="{{ seo_map[page].title_tag if page in seo_map else '' }}"
                           class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors placeholder-gray-600">
                </div>
                <div>
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Méta Description</label>
                    <textarea name="desc_{{ page }}" rows="2"
                              class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors placeholder-gray-600">{{ seo_map[page].meta_desc if page in seo_map else '' }}</textarea>
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-blue-100/80 mb-2">Mots-clés (Keywords)</label>
                    <input type="text" name="keywords_{{ page }}" value="{{ seo_map[page].keywords if page in seo_map and seo_map[page].keywords else '' }}"
                           class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-teal-500 focus:ring-1 focus:ring-teal-500 transition-colors placeholder-gray-600" placeholder="mot-clé1, mot-clé2, mot-clé3">
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Sticky Save Button -->
    <div class="fixed bottom-6 right-8 z-50">
        <button type="submit" class="bg-teal-600 hover:bg-teal-500 text-white font-bold py-4 px-8 rounded-full shadow-2xl transition-all transform hover:-translate-y-1 flex items-center gap-3 border-2 border-teal-400/20 backdrop-blur-sm">
            <span class="material-symbols-outlined">save</span>
            Sauvegarder tout
        </button>
    </div>
</form>
{% endblock %}
